/**
 * @name 日历组件
 * @author: bright
 * @mail: 772020653@qq.com
 * @website: http://stbui.com
 * @update: 2016.10.08
 */

var Calendar=function(a,c,d,b,e){this.options=b?b:[140,800,0.95,"solid","#EEE","#FFF",3,3,0.2,"#000","#444","#F6F8FD","#333","#F1F5FC","#000","#EFF3FB",true,true];this.toFixedZero=function(f){return f<10?"0"+f:f};this.booleanNotAuto=d;this.createContainer=function(q){var k=function(C){var B=";";var A=["width","height","left","top"];for(var z=0;z<4;z++){if(C[z]!="auto"){B+=A[z]+":"+C[z]+(typeof C[z]=="string"?"":"px")+";"}}return B};var x=["Top","Right","Bottom","Left"];var s=[];var h=";background-color:"+(q.style.backgroundColor?q.style.backgroundColor:this.options[5])+";";for(var u=0;u<4;u++){var l=q.style["border"+x[u]+"Width"];s[u]=l?l.replace("px","")*1:2;h+="border-"+x[u].toLowerCase()+"-width:"+s[u]+"px;";var n=q.style["border"+x[u]+"Style"];h+="border-"+x[u].toLowerCase()+"-style:"+(n?n:this.options[3])+";";var m=q.style["border"+x[u]+"Color"];h+="border-"+x[u].toLowerCase()+"-color:"+(m?m:this.options[4])+";"}var p=q.clientWidth;p=p<this.options[0]?this.options[0]:p;p=this.options[1]<p?this.options[1]:p;var r="";var t="";var g=";font-size:0px;line-height:0px;";if(navigator.appName=="Microsoft Internet Explorer"){r="filter:alpha(opacity="+this.options[2]*100+");";t="filter:alpha(opacity="+this.options[8]*100+");"}else{r="opacity:"+this.options[2]+";";t="opacity:"+this.options[8]+";"}var j=document.createElement("span");q.parentNode.insertBefore(j,q);var o=q.clientHeight+s[0]+s[2]+(q.offsetTop-j.offsetTop);j.style.position="relative";j.style.display="none";j.style.width="0px";var y=document.createElement("div");y.style.position="absolute";y.style.cssText+=k([p,"auto",0,o])+h+r;j.appendChild(y);var w=document.createElement("div");w.style.position="absolute";w.style.cssText+=k([this.options[6],y.clientHeight+s[1]+s[3],p+s[0]+s[2],o+this.options[7]])+"background-color:"+(q.style.borderRightColor?q.style.borderRightColor:this.options[9])+";"+t+g;j.appendChild(w);var f=document.createElement("div");f.style.position="absolute";f.style.cssText+=k([p+s[0]+s[2]-this.options[6],this.options[7],this.options[6],o+y.clientHeight+s[1]+s[3]])+"background-color:"+(q.style.borderBottomColor?q.style.borderBottomColor:this.options[9])+";"+t+g;j.appendChild(f);var v=document.createElement("div");v.style.position="absolute";v.style.cssText+=k([p<q.clientWidth?p:q.clientWidth,s[2]+s[0],s[3],o-s[2]])+";background-color:"+(q.style.backgroundColor?q.style.backgroundColor:this.options[5])+";"+g;if(q.style.borderBottomWidth){j.appendChild(v)}this.elementSpan=j;this.elementDiv=y;this.elementShadowDivRight=w;this.elementShadowDivBottom=f};this.romance=function(f){f.style.cursor="pointer";f.style.cssText+=";padding:2px 4px; line-height: 16px;";f.calendar=this;if(f.today){f.style.color=this.options[10];f.style.backgroundColor=this.options[11]}f.onmouseover=function(){if(this.today){this.style.color=this.calendar.options[14];this.style.backgroundColor=this.calendar.options[15]}else{this.style.color=this.calendar.options[12];this.style.backgroundColor=this.calendar.options[13]}if(parseInt(this.date)==this.date){this.calendar.keepShowing=true}};f.onmouseout=function(){if(this.today){this.style.color=this.calendar.options[10];this.style.backgroundColor=this.calendar.options[11]}else{this.style.color="";this.style.backgroundColor=""}this.calendar.keepShowing=false};f.onmousedown=function(){if(parseInt(this.date)==this.date){this.calendar.keepShowing=true;var h=this.calendar.date;var g=new Date(h[0],h[1]+this.date,h[2]);this.calendar.date=[g.getFullYear(),g.getMonth(),g.getDate()];this.calendar.elementTarget.value=this.calendar.date[0].toString()+"-"+this.calendar.toFixedZero(this.calendar.date[1]+1)+"-"+this.calendar.toFixedZero(this.calendar.date[2]);this.calendar.resetCalendar(this.calendar.date)}else{this.calendar.keepShowing=false;this.calendar.date=this.date;this.calendar.elementTarget.value=this.calendar.date[0].toString()+"-"+this.calendar.toFixedZero(this.calendar.date[1]+1)+"-"+this.calendar.toFixedZero(this.calendar.date[2]);if(typeof e=="function"){e()}}}};this.resetShadow=function(){var f=this.elementDiv.clientHeight+this.elementDiv.style.borderTopWidth.replace("px","")*1+this.elementDiv.style.borderBottomWidth.replace("px","")*1;this.elementShadowDivRight.style.height=f+"px";this.elementShadowDivBottom.style.top=this.elementDiv.style.top.replace("px","")*1+f+"px"};this.resetCalendar=function(q){this.elementDiv.innerHTML="";var m="width:12px; font-size:18px;";var k="width:100%; color:#000; font-size:12px; text-align:center;";var h=document.createElement("table");h.style.cssText+=k;h.cellPadding=0;h.cellSpacing=0;var y=h.insertRow(0);y.style.cssText+="background-color:#F3F3F3; line-height:20px;";var v=y.insertCell(0);v.style.cssText+=m;v.innerHTML="&laquo;";v.date=-12;this.romance(v);var w=y.insertCell(1);w.innerHTML="&lsaquo;";w.style.cssText+=m;w.date=-1;this.romance(w);var f=y.insertCell(2);f.innerHTML=q[0]+"\u5e74"+this.toFixedZero(q[1]+1)+"\u6708";var g=y.insertCell(3);g.innerHTML="&rsaquo;";g.style.cssText+=m;g.date=1;this.romance(g);var l=y.insertCell(4);l.innerHTML="&raquo;";l.style.cssText+=m;l.date=12;this.romance(l);this.elementDiv.appendChild(h);var s=document.createElement("table");s.style.cssText+=k;s.cellPadding=0;s.cellSpacing=0;var r=s.insertRow(0);var p=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];for(var z=0;z<7;z++){var u=r.insertCell(z);u.innerHTML=p[z];u.style.cssText+=";padding:2px 4px; line-height: 16px;"}var x=new Date(q[0],q[1],1).getDay();var n=[31,28,31,30,31,30,31,31,30,31,30,31];if(q[1]==1&&((q[0]%4==0&&q[0]%100!=0)||q[0]%400==0)){n[1]=29}var o=0;var A=1;var j=s.insertRow(A);for(var z=0;z<x;z++){var t=j.insertCell(z);o++}for(var z=1;z<n[q[1]]+1;z++){if(o==0){A++;j=s.insertRow(A)}t=j.insertCell(o);t.innerHTML=z.toString();t.today=z==q[2]?true:false;t.date=[q[0],q[1],z];this.romance(t);o++;o=o==7?0:o}if(o!=0){for(var z=o;z<7;z++){var t=j.insertCell(z)}}this.elementDiv.appendChild(s);this.resetShadow()};this.hideSelects=function(){if(navigator.appVersion.indexOf("MSIE 6.0")!=-1){var g=document.getElementsByTagName("select");var h=g.length;for(var f=0;f<h;f++){g[f].style.visibility="hidden"}}};this.showSelects=function(){if(navigator.appVersion.indexOf("MSIE 6.0")!=-1){var g=document.getElementsByTagName("select");var h=g.length;for(var f=0;f<h;f++){g[f].style.visibility=""}}};this.showForce=function(){if(this.options[17]){this.hideSelects()}this.elementSpan.style.display="";this.resetShadow()};this.show=function(){if(this.booleanNotAuto){return}if(this.options[17]){this.hideSelects()}this.elementSpan.style.display="";this.resetShadow()};this.hide=function(){if(this.options[17]){this.showSelects()}this.elementSpan.style.display="none"};this.showStandalone=function(){arguments.callee.object.show()};this.showStandalone.object=this;this.bind=function(h,g,j){if(typeof h=="string"){var k=document.getElementById(h)}else{var k=h}this.elementTarget=k;this.createContainer(k);k.readOnly=this.options[16];k.autocomplete="off";k.calendar=this;if(k.value==""||k.value.match(/^\d{4}-\d{1,2}-\d{1,2}$/)==null){var i=new Date();k.value=k.value==""?"":i.getFullYear().toString()+"-"+this.toFixedZero(i.getMonth()+1)+"-"+this.toFixedZero(i.getDate());this.date=[i.getFullYear(),i.getMonth(),i.getDate()]}else{var l=k.value.split("-");this.date=[l[0]*1,l[1]*1-1,l[2]*1]}this.resetCalendar(this.date);if(!j){k.onfocus=function(){this.calendar.show()};k.onblur=function(){if(this.calendar.keepShowing){this.focus();setTimeout(this.calendar.showStandalone,1)}else{this.calendar.hide()}}}if(g){if(typeof g=="string"){var f=document.getElementById(g)}else{var f=g}f.style.cursor="pointer";f.calendar=this;f.onclick=function(){this.calendar.elementTarget.focus();this.calendar.showForce()}}};this.bind(a,c)};

module.exports = Calendar;